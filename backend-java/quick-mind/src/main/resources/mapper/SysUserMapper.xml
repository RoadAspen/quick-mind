<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- 命名空间：必须和 Mapper 接口的全类名一致 -->
<mapper namespace="com.quickmind.mapper.SysUserMapper">
    <!-- 自定义 SQL 查询：根据用户名查询用户信息 -->
    <select id="selectByUserName" resultType="com.quickmind.entity.SysUser">
        <!-- SQL语句：根据用户名查询用户信息, #{userName} 是参数占位符,表示传入的用户名,和mapper中的方法参数对应  -->
        SELECT * FROM sys_user WHERE user_name = #{userName} LIMIT 1;
    </select>

    <!--    自动以SQL查询: 根据分页信息查询用户列表-->
    <select id="selectUserList" resultType="com.quickmind.entity.vo.SysUserListVO">
        SELECT
        u.user_id,
        u.user_name,
        u.nick_name,
        u.email,
        u.phone,
        u.sex,
        u.avatar,
        d.dept_id,
        d.dept_name,
        u.status,
        u.del_flag,
        u.login_ip,
        u.login_date,
        u.create_by,
        u.create_time,
        u.update_by,
        u.update_time,
        u.remark
        FROM sys_user u
        LEFT JOIN sys_dept d ON u.dept_id = d.dept_id
        <where>
            <if test="user.userName != null and user.userName != ''">
                AND u.user_name LIKE CONCAT('%', #{user.userName}, '%')
            </if>
            <if test="user.status != null and user.status != ''">
                AND u.status = #{user.status}
            </if>
        </where>
        ORDER BY u.create_time DESC
        LIMIT
        <if test="offset != null and offset &gt;= 0">#{offset}</if>
        <if test="offset == null or offset &lt;0">0</if>,
        <if test="pageSize != null and pageSize &gt; 0 and pageSize &lt;= 100">#{pageSize}</if>
        <if test="pageSize == null or pageSize &lt;= 0 or pageSize &gt; 100">10</if>
    </select>
    <!--    查询总记录数-->
    <select id="selectUserCount" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM sys_user
        <where>
            <if test="user.userName != null and user.userName != ''">
                AND user_name LIKE CONCAT('%', #{user.userName}, '%')
            </if>
            <if test="user.status != null and user.status != ''">
                AND status = #{user.status}
            </if>
        </where>
    </select>
</mapper>
